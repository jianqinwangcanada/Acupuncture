function LoadUsers(){$.ajax({type:"GET",url:"/api/v1/User/GetUsers",dataType:"json",success:function(n){var t=JSON.stringify(n);table.setData(t)}})}function getCountries(){$.ajax({type:"GET",url:"/api/v1/Country/GetCountries",dataType:"json","async":!1,success:function(n){if(countries=n,countries){let n='<option value="Select Country" disabled selected>Select<\/option>';$.each(countries,function(t,i){n+='<option value="'+i.id+'">'+i.flag+" "+i.name+"<\/option>"});$billingCountryDropdown.append(n);$_billingCountryDropdown.append(n);$shippingCountryDropdown.append(n);$_shippingCountryDropdown.append(n);$billingCountryDropdown.chosen();$_billingCountryDropdown.chosen();$shippingCountryDropdown.chosen();$_shippingCountryDropdown.chosen()}}})}function resetPassword(){$.ajax({type:"POST",url:"/api/v1/user/ResetPassword/"+$("#_username").val(),contentType:!1,processData:!1,success:function(n){$("#addUserForm")[0].reset();$("#AddUserModal").modal("hide");Swal.fire("Password Reset",n,"success").then(LoadUsers())}})}function addUser(n){n.get("IsEmployee")==="true"?n.set("IsEmployee","1"):n.set("IsEmployee","0");n.get("IsAccountLocked")==="true"?n.set("IsAccountLocked","1"):n.set("IsAccountLocked","0");n.get("IsPhoneVerified")==="true"?n.set("IsPhoneVerified","1"):n.set("IsPhoneVerified","0");n.get("IsTwoFactorOn")==="true"?n.set("IsTwoFactorOn","1"):n.set("IsTwoFactorOn","0");n.get("IsEmailVerified")==="true"?n.set("IsEmailVerified","1"):n.set("IsEmailVerified","0");n.set("IsTermsAccepted","1");$.ajax({type:"POST",url:"/api/v1/user/adduser/",data:n,contentType:!1,processData:!1,success:function(n){$("#AddUserModal").modal("hide");Swal.fire("User Created",n,"success").then(LoadUsers())},error:function(n){const t=n.responseText.split(",");Swal.fire({title:"Error!",text:"User Could not be created.",footer:makeArrayList(t)})}})}function GetUserByUsername(n){$.ajax({type:"GET",url:"/api/v1/User/GetUserByUserName/"+n,dataType:"json",success:function(n){console.log(n);$("#userId").text(n.userId);$("#_firstname").val(n.firstname);$("#_middlename").val(n.middlename);$("#_lastname").val(n.lastname);$("#_email").val(n.email);$("#_username").val(n.username);$("#_phone").val(n.phone);$("#_birthdate").datepicker("setDate",new Date(n.birthday));$("#_gender").val(n.gender).trigger("chosen:updated");$("#_displayname").val(n.displayname);$("#_role").val(n.userRole);console.log("fuck");console.log($("#_role").val());console.log(n.userRole);$("#_imgProfile").attr("src",n.profilePic);n.useAddress.forEach(n=>{if(n.type==="Billing"){console.log("Billing");let t=n;for(let n in t)if(t.hasOwnProperty(n)){t[n]===null&&(t[n]="");let i="#_"+n+"";n==="line1"&&$("#_address1").val(t[n]);n==="line2"&&$("#_address2").val(t[n]);n==="postalCode"?$("#_postalcode").val(t[n]):$(i).val(t[n])}}if(n.type==="Shipping"){let t=n;for(let n in t)if(t.hasOwnProperty(n)){t[n]===null&&(t[n]="");let i="#_s"+n+"";n==="line1"&&$("#_saddress1").val(t[n]);n==="line2"&&$("#_saddress2").val(t[n]);n==="postalCode"?$("#_spostalcode").val(t[n]):$(i).val(t[n])}}});let t=n.useAddress[0].type==="Billing"?n.useAddress[0].country:n.useAddress[1].country,r=n.useAddress[0].type==="Billing"?n.useAddress[0].state:n.useAddress[1].state,i=n.useAddress[1].type==="Shipping"?n.useAddress[1].country:n.useAddress[0].country,u=n.useAddress[1].type==="Shipping"?n.useAddress[1].state:n.useAddress[0].state;if(t!==null&&t!==""){let n=countries.filter(function(n){return n.name===t});if(n.length>0){$_billingCountryDropdown.val(n[0].id).trigger("chosen:updated");let t=[];if(n[0].states!==null&&n[0].states!==""){t=n[0].states.split("|");let i='<option value="Select State" disabled selected>Select<\/option>';$.each(t,function(n,t){i+='<option value="'+t+'">'+t+"<\/option>"});$_billingStateDropdown.append(i);$_billingStateDropdown.chosen();$_billingStateDropdown.val(r).trigger("chosen:updated")}}}if(i!==null&&i!==""){let n=countries.filter(function(n){return n.name===i});if(n.length>0){$_shippingCountryDropdown.val(n[0].id).trigger("chosen:updated");let t=[];if(n[0].states!==null&&n[0].states!==""){t=n[0].states.split("|");let i='<option value="Select State" disabled selected>Select<\/option>';$.each(t,function(n,t){i+='<option value="'+t+'">'+t+"<\/option>"});$_shippingStateDropdown.append(i);$_shippingStateDropdown.chosen();$_shippingStateDropdown.val(u).trigger("chosen:updated")}}}$("#EditUserModal #_IsTermsAccepted").attr("checked",n.isTermsAccepted);$("#EditUserModal #_IsAccountLocked").attr("checked",n.isAccountLocked);$("#EditUserModal #_IsEmailVerified").attr("checked",n.isEmailVerified);$("#EditUserModal #_IsPhoneVerified").attr("checked",n.isPhoneVerified);$("#EditUserModal #_IsEmployee").attr("checked",n.isEmployee);$("#EditUserModal #_IsTwoFactorOn").attr("checked",n.isTwoFactorOn)}})}function EditUser(n){n.get("IsEmployee")==="true"?n.set("IsEmployee","1"):n.set("IsEmployee","0");n.get("IsAccountLocked")==="true"?n.set("IsAccountLocked","1"):n.set("IsAccountLocked","0");n.get("IsPhoneVerified")==="true"?n.set("IsPhoneVerified","1"):n.set("IsPhoneVerified","0");n.get("IsTwoFactorOn")==="true"?n.set("IsTwoFactorOn","1"):n.set("IsTwoFactorOn","0");n.get("IsEmailVerified")==="true"?n.set("IsEmailVerified","1"):n.set("IsEmailVerified","0");n.set("IsTermsAccepted","1");console.log(n.get("IsEmployee"));var t=$("#userId").text();$.ajax({type:"PUT",url:"/api/v1/user/edituser/"+t,data:n,contentType:!1,processData:!1,success:function(n){$("#editUserForm")[0].reset();$("#EditUserModal").modal("hide");Swal.fire("User Details Edited",n,"success").then(LoadUsers())},error:function(n){const t=n.responseText.split(",");Swal.fire({title:"Error!",text:"User details Could not be edited.",footer:makeArrayList(t)})}})}function confirmDeleteUser(){var n=$("#toDeleteUr").text();n!==""&&$.ajax({type:"DELETE",url:"/api/v1/User/DeleteUser/"+n,contentType:"application/json","async":!0,success:function(){$("#DeleteUserModal").modal("hide");Swal.fire("Sucess!","User : "+n+" deleted.","success");LoadUsers()},error:function(){Swal.fire({type:"error",title:"Oops...",text:"Request cannot be completed. Please try again later."})}})}function addNewUser(){GetAllApplicationRoles("#role");$("#roleError").text("");$("#AddUserModal").modal("show");$("#AddUserModal .modal-title").html("Add New User")}function editUserById(n){let t=$(n).data("username");GetAllApplicationRoles("#_role");GetUserByUsername(t);$("#EditUserModal").modal("show");$("#EditUserModal .modal-title").html("Edit User")}function deleteUser(n){var t=$(n).data("deluser");$("#DeleteUserModal").modal("show");$("#DeleteUserModal .modal-title").html("Delete Confirmation");$("#DeleteUserModal .modal-body").html("Do You Want To Delete User with Id : <strong class='text-danger'><span id='toDeleteUr'>"+t+"<\/span><\/strong>")}function openFileExplorer(n){let t=$(n).data("type");t==="editForm"&&$(n).closest("div").find("#_profpicfile").trigger("click");t==="addForm"&&$(n).closest("div").find("#profpicfile").trigger("click")}function PreviewImage(n){let t=[],i=$(n).data("type");if(i==="editForm"&&(t=document.querySelector("#_profpicfile").files),i==="addForm"&&(t=document.querySelector("#profpicfile").files),!(t.length<=0)){/\.(jpe?g|png|gif)$/i.test(t[0].name)||console.log("Please upload valid image type");console.log(t[0].name);var r=new FileReader;r.onload=function(){i==="editForm"&&$("#_imgProfile").attr("src",r.result);i==="addForm"&&$("#imgProfile").attr("src",r.result)};r.readAsDataURL(t[0])}}function generatePassword(){var n=password_generator(6);$("#password").val(n).focus()}function makeArrayList(n){let t=document.createElement("ul");t.className="list-group";for(let i=0;i<n.length;i++){let r=document.createElement("li");r.className="list-group-item";r.appendChild(document.createTextNode(n[i].replace(/[\[\]"]/g,"")));t.appendChild(r)}return t}function getCookie(n){for(var t,r=n+"=",f=decodeURIComponent(document.cookie),u=f.split(";"),i=0;i<u.length;i++){for(t=u[i];t.charAt(0)===" ";)t=t.substring(1);if(t.indexOf(r)===0)return t.substring(r.length,t.length)}return""}function loadCoppyShippingStates(n,t){let r=n,i=countries.filter(function(n){return n.id===Number(r)});if(i.length>0){let n=[];if(i[0].states!==null&&i[0].states!==""){n=i[0].states.split("|");let r='<option value="Select State" disabled selected>Select<\/option>';$.each(n,function(n,t){r+='<option value="'+t+'">'+t+"<\/option>"});t==="addForm"?($shippingStateDropdown.html(""),$shippingStateDropdown.append(r),$shippingStateDropdown.prop("disabled",!1).trigger("chosen:updated")):($_shippingStateDropdown.empty(),$_shippingStateDropdown.append(r),$_shippingStateDropdown.prop("disabled",!1).trigger("chosen:updated"))}else(t="addForm")?($shippingStateDropdown.val(null),$shippingStateDropdown.prop("disabled",!0).trigger("chosen:updated")):($_shippingStateDropdown.val(null),$_shippingStateDropdown.prop("disabled",!0).trigger("chosen:updated"))}}function GetAllApplicationRoles(n){$.ajax({type:"GET",url:"/api/v1/UserRole/GetRoles/",dataType:"json",success:function(t){console.log(t);$(n).empty();$(n).append("<option  disabled selected>Select Role<\/option>");t.forEach(t=>{$(n).append('<option value="'+t.roleName+'">'+t.roleName+"<\/option>")});$(n).append("<\/option>")}})}var table,copyBillingAddress;const genderValues=["Male","Female","Transgender","Two-Spirit","Cisgender","Non-Binary","Gender Neutral","Prefer Not To Say","Other"],$addGenderDropdown=$("#gender"),$_addGenderDropdown=$("#_gender"),$shippingCountryDropdown=$("#scountry"),$_shippingCountryDropdown=$("#_scountry"),$billingCountryDropdown=$("#country"),$_billingCountryDropdown=$("#_country"),$shippingStateDropdown=$("#sstate"),$_shippingStateDropdown=$("#_sstate"),$billingStateDropdown=$("#state"),$_billingStateDropdown=$("#_state");let countries=[];$(function(){LoadUsers();getCountries();let n='<option value="Select Gender" disabled selected>Select<\/option>';$.each(genderValues,function(t,i){n+='<option value="'+i+'">'+i+"<\/option>"});$addGenderDropdown.append(n);$addGenderDropdown.chosen();$_addGenderDropdown.append(n);$_addGenderDropdown.chosen();$shippingStateDropdown.chosen();$billingStateDropdown.chosen();$_shippingStateDropdown.chosen();$_billingStateDropdown.chosen();$billingCountryDropdown.chosen().change(function(n){console.log($(n.target).val());let i=$(n.target).val(),t=countries.filter(function(n){return n.id===Number(i)});if(t.length>0){let n=[];if(t[0].states!==null&&t[0].states!==""){n=t[0].states.split("|");let i='<option value="Select State" disabled selected>Select<\/option>';$.each(n,function(n,t){i+='<option value="'+t+'">'+t+"<\/option>"});$billingStateDropdown.html("");$billingStateDropdown.append(i);$billingStateDropdown.prop("disabled",!1).trigger("chosen:updated")}else $billingStateDropdown.val(null),$billingStateDropdown.prop("disabled",!0).trigger("chosen:updated")}});$shippingCountryDropdown.chosen().change(function(n){console.log($(n.target).val());let i=$(n.target).val(),t=countries.filter(function(n){return n.id===Number(i)});if(t.length>0){let n=[];if(t[0].states!==null&&t[0].states!==""){n=t[0].states.split("|");let i='<option value="Select State" disabled selected>Select<\/option>';$.each(n,function(n,t){i+='<option value="'+t+'">'+t+"<\/option>"});$shippingStateDropdown.html("");$shippingStateDropdown.append(i);$shippingStateDropdown.prop("disabled",!1).trigger("chosen:updated")}else $shippingStateDropdown.val(null),$shippingStateDropdown.prop("disabled",!0).trigger("chosen:updated")}});$_billingCountryDropdown.chosen().change(function(n){console.log($(n.target).val());let i=$(n.target).val(),t=countries.filter(function(n){return n.id===Number(i)});if(t.length>0){let n=[];if(t[0].states!==null&&t[0].states!==""){n=t[0].states.split("|");let i='<option value="Select State" disabled selected>Select<\/option>';$.each(n,function(n,t){i+='<option value="'+t+'">'+t+"<\/option>"});$_billingStateDropdown.html("");$_billingStateDropdown.append(i);$_billingStateDropdown.prop("disabled",!1).trigger("chosen:updated")}else $_billingStateDropdown.val(null),$_billingStateDropdown.prop("disabled",!0).trigger("chosen:updated")}});$_shippingCountryDropdown.chosen().change(function(n){console.log($(n.target).val());let i=$(n.target).val(),t=countries.filter(function(n){return n.id===Number(i)});if(t.length>0){let n=[];if(t[0].states!==null&&t[0].states!==""){n=t[0].states.split("|");let i='<option value="Select State" disabled selected>Select<\/option>';$.each(n,function(n,t){i+='<option value="'+t+'">'+t+"<\/option>"});$_shippingStateDropdown.html("");$_shippingStateDropdown.append(i);$_shippingStateDropdown.prop("disabled",!1).trigger("chosen:updated")}else $_shippingStateDropdown.val(null),$_shippingStateDropdown.prop("disabled",!0).trigger("chosen:updated")}});$("#addUserFormsubmit").click(function(n){if(n.preventDefault(),$("#addUserForm").valid()){let t=new FormData(n.target.form);if(t.get("BillingAddress.Country")!==null||t.get("BillingAddress.Country")!==""){let n=countries.filter(function(n){return n.id===Number(t.get("BillingAddress.Country"))});t.set("BillingAddress.Country",n[0].name)}if(t.get("ShippingAddress.Country")!==null||t.get("ShippingAddress.Country")!==""){let n=countries.filter(function(n){return n.id===Number(t.get("ShippingAddress.Country"))});t.set("ShippingAddress.Country",n[0].name)}addUser(t)}else{var t=$("form").find(".field-validation-error span");console.log(t)}});$("#editUserFormSubmit").click(function(n){var t,i;if(n.preventDefault(),$("#editUserForm").valid()){if(t=new FormData(n.target.form),t.get("BillingAddress.Country")!==null||t.get("BillingAddress.Country")!==""){let n=countries.filter(function(n){return n.id===Number(t.get("BillingAddress.Country"))});t.set("BillingAddress.Country",n[0].name)}if(t.get("ShippingAddress.Country")!==null||t.get("ShippingAddress.Country")!==""){let n=countries.filter(function(n){return n.id===Number(t.get("ShippingAddress.Country"))});t.set("ShippingAddress.Country",n[0].name)}EditUser(t)}else i=$("form").find(".field-validation-error span"),console.log(i)});$("#birthdate").datepicker();$("#_birthdate").datepicker()});table=new Tabulator("#usersTable",{layout:"fitColumns",responsiveLayout:"hide",tooltips:!0,addRowPos:"top",history:!0,pagination:"local",paginationSize:7,movableColumns:!0,resizableRows:!1,initialSort:[{column:"username",dir:"asc"}],columns:[{title:"Username",field:"username"},{title:"Firstname",field:"firstname"},{title:"Lastname",field:"lastname"},{title:"Email",field:"email"},{title:"ProfilePic",field:"profilePic",formatter:"image",formatterParams:{height:"50px",width:"50px"}},{title:"ProfileComplete",field:"isProfileComplete",formatter:"tickCross"},{title:"Active",field:"isActive",formatter:"tickCross"},{title:"Actions",align:"center",formatter:function(n){var t=n.getData().username,i=n.getData().firstname,r=n.getData().lastname;return"<div class='btn-group' role='group' aria-label='Perform Actions'><button type='button' name='Edit'  class='btn btn-primary btn-sm' onclick='editUserById(this)'  data-username='"+t+"'  data-name='"+i+"'  data-normalname='"+r+"' ><span><i class='fa fa-edit'><\/i><\/span><\/button><button type='button' name='Delete' data-deluser='"+t+"'  class='btn btn-danger btn-sm' onclick='deleteUser(this)' ><span><i class='fa fa-trash'><\/i><\/span><\/button><\/div>"}}]});copyBillingAddress=function(n){var r,f;let t=$(n).data("type");if(t==="editForm"){var e=$("#_address1").val(),o=$("#_address2").val(),s=$("#_unit").val(),u=$("#_country").val(),h=$("#_city").val(),c=$("#_state").val(),l=$("#_postalcode").val(),w=$("#_birthdate").val();loadCoppyShippingStates(u,t);$("#_saddress1").val(e);$("#_saddress2").val(o);$("#_sunit").val(s);$("#_scountry").val(u);$("#_scity").val(h);$("#_sstate").val(c);$("#_spostalcode").val(l)}if(t==="addForm"){var a=$("#address1").val(),v=$("#address2").val(),y=$("#unit").val(),i=$("#country").val(),p=$("#city").val();loadCoppyShippingStates(i,t);r=$("#state").val();f=$("#postalcode").val();console.log(i);console.log(r);$("#saddress1").val(a);$("#saddress2").val(v);$("#sunit").val(y);$("#scountry").val(i);$("#scity").val(p);$("#sstate").val(r);$("#spostalcode").val(f)}};